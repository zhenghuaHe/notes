# MySQL 的逻辑架构图
## ![mysql-luoji](../Map/mysql-luoji.png)


# 主从复制
## ![mysql](../Map/mysql.png)
* 主从复制的过程
1. master将改变记录到二进制日志(binary log)中（这些记录叫做二进制日志事件，binary log events）；
2. slave将master的binary log events拷贝到它的中继日志(relay log)；
3. slave重做中继日志中的事件，将改变反映它自己的数据。

* 影响主从同步数据不一致的问题
1. 网络的延迟。主从复制是依赖网络传送binlog文件，跨机房出现这个几率很大
2. 版本不一致，特别是高版本是主，低版本为从的情况下，主数据库上面支持的功能，从数据库上面不支持该功能
3. 硬件配置不一致。从服务器至少和主服务器配置一致。
4. 主从两台机器的负载不一致。由于mysql主从复制是主数据库上面启动1个io线程，而从上面启动1个sql线程和1个io线程，当中任何一台机器的负载很高，忙不过来，导致其中的任何一个线程出现资源不足，都将出现主从不一致的情况。
5. mysql异常宕机情况下，如果未设置sync_binlog=1或者innodb_flush_log_at_trx_commit=1很有可能出现binlog或者relaylog文件出现损坏，导致主从不一致。
6. max_allowed_packet设置不一致。主数据库上面设置的max_allowed_packet比从数据库大，当一个大的sql语句，能在主数据库上面执行完毕，从数据库上面设置过小，无法执行，导致的主从不一致。

* 主从数据不一致的解决方法
1. 忽略错误后，继续同步。该方法适用于主从库数据相差不大，或者要求数据可以不完全统一的情况，数据要求不严格的情况
2. 重新做主从，完全同步。该方法适用于主从库数据相差较大，或者要求数据完全统一的情况





## 主从复制的目的和架构
1. Master/Slave（主/从）
    > Master: write/read

    > Slaves: read


2. 主从复制的目的
* 冗余：promte（提升为主），异地灾备
* 负载均衡：转移一部分“读”请求；
* 资源安全的备份操作；
* 日常测试；


3. 复制的方式：
* ☉同步复制：
    > 所谓的同步复制，意思是master的变化，必须等待slave-1,slave-2,...,slave-n完成后才能返回。这样，显然不可取，也不是MYSQL复制的默认设置。比如，在WEB前端页面上，用户增加了条记录，需要等待很长时间。
* ☉异步复制：
    > master只需要完成自己的数据库操作即可。至于slaves是否收到二进制日志，是否完成操作，不用关心。MYSQL的默认设置。
* ☉半同步复制：
    > master只保证slaves中的一个操作成功，就返回，其他slave不管。这个功能，是由google为MYSQL引入的。




* 常识部分
    > 常见的备份方法：mysqldump　、　xtrabackup(热备份)

    > mysqldump命令适用于对数据库相对较小的MySQL进行备份，一般数据量约50GB以内，大于50GB强烈建议使用xtrabackup工具。

    > mysqldump备份，如果有插入、修改操作，必然会锁表，可加入--skip-opt参数解决,或者选择在深夜访问少的时候。



* MySQL常见的引擎有哪些以及区别？
    > Mysql常见的三种存储引擎为InnoDB、MyISAM、MEMORY。InnoDB是Mysql的默认存储引擎，Mysql5.5.5之前是MyISAM。

特性|Innodb|MyISAM|MEMORY
:---:|:---:|:---:|:---:
事物安全|支持|不支持|不支持
对外建的支持|支持|不支持|不支持
存储限制|64TB|有|有
空间使用|高|低|低
内存使用|高|低|高
插入数据的速度|低|高|高

```
Mysql三种引擎的特点：
1、InnoDB存储引擎

InnoDB是事务型数据库的首选引擎，支持事务安全表（ACID），其它存储引擎都是非事务安全表，支持行锁定和外键，支持崩溃修复能力和并发控制。如果需要对事务的完整性要求比较高（比如银行），要求实现并发控制（比如售票），那选择InnoDB有很大的优势。

2、MyISAM存储引擎

MyISAM基于ISAM存储引擎，并对其进行扩展。它是在Web、数据仓储和其他应用环境下最常使用的存储引擎之一。MyISAM拥有较高的插入、查询速度，但不支持事务，不支持外键。

插入数据快，空间和内存使用比较低。如果表主要是用于插入新记录和读出记录，那么选择MyISAM能实现处理高效率。如果应用的完整性、并发性要求比较低，也可以使用

3、MEMORY存储引擎

MEMORY存储引擎将表中的数据存储到内存中，为查询和引用其他表数据提供快速访问。

MEMORY特点： 所有的数据都在内存中，数据的处理速度快，但是安全性不高。如果需要很快的读写速度，对数据的安全性要求较低，可以选择MEMOEY。

```
* MySQL的索引有哪些以及区别？

```
Mysql常见索引有：主键索引、唯一索引、普通索引、全文索引、组合索引

Mysql各种索引区别：
普通索引：最基本的索引，没有任何限制
唯一索引：与"普通索引"类似，不同的就是：索引列的值必须唯一，但允许有空值。
主键索引：它 是一种特殊的唯一索引，不允许有空值。（推荐使用）
全文索引：仅可用于 MyISAM 表，针对较大的数据，生成全文索引很耗时好空间。
组合索引：为了更多的提高mysql效率可建立组合索引，遵循”最左前缀“原则。创建复合索引时应该将最常用（频率）作限制条件的列放在最左边，依次递减。

组合索引最左字段用in是可以用到索引的，最好explain一下select。

常见的索引模型：哈希表、有序数组、搜索树
哈希表：把要查的值换算成哈希值，然后去数据库里去遍历
```
