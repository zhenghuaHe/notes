

- 清除filter表中的INPUT链的规则
$ iptables -F INPUT

- 确认没有任何规则，默认是全部通过
$ iptables -nL INPUT

- 增加规则(-I 添加规则，首部插入　-A 追加规则，尾部追加)
命令语法：iptables -t 表名 -A 链名 匹配条件 -j 动作
命令语法：iptables -t 表名 -I 链名 匹配条件 -j 动作
命令语法：iptables -t 表名 -I 链名 规则序号 匹配条件 -j 动作
命令语法：iptables -t 表名 -P 链名 动作

- 拒绝来自某ip的链接
$ iptables -t filter -I INPUT -s 172.16.1.227 -j DROP
$ iptables -vnL INPUT
Chain INPUT (policy ACCEPT 6 packets, 436 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  *      *       172.16.1.227         0.0.0.0/0

测试：通过ping和ssh链接都连不过去啦,会一直没响应！


- 规则匹配是从上到下逐个匹配，只要有一条生效了后面的就不会生效了。(INPUT后面加数字可以直接加到指定的位置。)
$ iptables -t filter -I INPUT 3 -s 172.16.1.227 -j ACCEPT
$ iptables -vnL INPUT --line-number
Chain INPUT (policy ACCEPT 35 packets, 2448 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        2   168 ACCEPT     all  --  *      *       172.16.1.227         0.0.0.0/0
2        5   372 DROP       all  --  *      *       172.16.1.227         0.0.0.0/0
3        0     0 ACCEPT     all  --  *      *       172.16.1.227         0.0.0.0/0


- 匹配条件的更多用法：
１、更多目标地址
查看filter表的INPUT链:
$ iptables -t filter -vnL INPUT
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
  647 51532 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    1    84 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0
    1    60 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            state NEW tcp dpt:22
    2   156 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibited

- 抛弃多个ip地址：
$ iptables -t filter -I INPUT -s 172.16.1.226,172.16.1.227 -j DROP
$ iptables -t filter -vnL INPUT
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  *      *       172.16.1.227         0.0.0.0/0
    0     0 DROP       all  --  *      *       172.16.1.226         0.0.0.0/0
  670 53152 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    1    84 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0
    1    60 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            state NEW tcp dpt:22
    2   156 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibited

- 抛弃某个网段
$ iptables -t filter -I INPUT -s 172.16.3.0/24 -j DROP
$ iptables -t filter -vnL INPUT
Chain INPUT (policy ACCEPT 0 packets, 0 bytes)
 pkts bytes target     prot opt in     out     source               destination
    0     0 DROP       all  --  *      *       172.16.3.0/24        0.0.0.0/0
    0     0 DROP       all  --  *      *       172.16.1.227         0.0.0.0/0
    0     0 DROP       all  --  *      *       172.16.1.226         0.0.0.0/0
 1113 94921 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
    2   168 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0
    0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0
    4   240 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            state NEW tcp dpt:22
    2   156 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibited


２、协议类型









- 删除规则
１、根据规则的编号删除
２、根据具体匹配条件和动作删除
命令语法：iptables -t 表名 -D 链名 规则序号
命令语法：iptables -t 表名 -D 链名 匹配条件 -j 动作


$ iptables -vnL INPUT --line-number
Chain INPUT (policy ACCEPT 35 packets, 2448 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        2   168 ACCEPT     all  --  *      *       172.16.1.227         0.0.0.0/0
2        5   372 DROP       all  --  *      *       172.16.1.227         0.0.0.0/0
3        0     0 ACCEPT     all  --  *      *       172.16.1.227         0.0.0.0/0

- 根据规则编号删除
$ iptables -t filter -D INPUT 3
$ iptables -vnL INPUT --line-number
Chain INPUT (policy ACCEPT 7 packets, 488 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        2   168 ACCEPT     all  --  *      *       172.16.1.227         0.0.0.0/0
2        5   372 DROP       all  --  *      *       172.16.1.227         0.0.0.0/0

- 根据具体匹配条件和动作删除
$ iptables -t filter -D INPUT -s 172.16.1.227 -j ACCEPT  (iptables -t 表名　-D 链名　-s 源地址匹配条件　-j 对应的动作)
$ iptables -vnL INPUT --line-number
Chain INPUT (policy ACCEPT 7 packets, 488 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        5   372 DROP       all  --  *      *       172.16.1.227         0.0.0.0/0



- 修改规则
１、根据指定的编号修改（慎用，规则较多容易错改）
２、建议先删除再增加的方式
命令语法：iptables -t 表名 -R 链名 规则序号 规则原本的匹配条件 -j 动作
命令语法：iptables -t 表名 -P 链名 动作


$ iptables -vnL INPUT --line-number
Chain INPUT (policy ACCEPT 7 packets, 488 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        5   372 DROP       all  --  *      *       172.16.1.227         0.0.0.0/0

- 根据指定编号修改
[root@localhost ~]# iptables -t filter -R INPUT 1  -s 172.16.1.227 -j REJECT　　（-R 修改指定的链,-s 指定源地址，不指定的话会被修改成0.0.0.0/0）
[root@localhost ~]# iptables -vnL INPUT --line-number
Chain INPUT (policy ACCEPT 9 packets, 636 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 REJECT     all  --  *      *       172.16.1.227         0.0.0.0/0            reject-with icmp-port-unreachable

修改为拒绝之后，再去链接会直接返回被拒绝

- 修改表上链的默认策略：
$ iptables -t filter -P FORWARD DROP  (-P 指定要修改的链，修改为DROP)
$ iptables -vnL FORWARD --line-number
Chain FORWARD (policy DROP 0 packets, 0 bytes)
num   pkts bytes target     prot opt in     out     source               destination
1        0     0 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate RELATED,ESTABLISHED
2        0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0



- 保存规则

centos6中：　service iptables save  规则默认保存在：/etc/sysconfig/iptables

centos7中：　iptables-save >> /etc/sysconfig/iptables (保存规则并追加到文件)
            iptables-restore << /etc/sysconfig/iptables (重载文件中的规则，未保存的将丢失或被覆盖）
#配置好yum源以后安装iptables-service
# yum install -y iptables-services
#停止firewalld
# systemctl stop firewalld
#禁止firewalld自动启动
# systemctl disable firewalld
#启动iptables
# systemctl start iptables
#将iptables设置为开机自动启动，以后即可通过iptables-service控制iptables服务
# systemctl enable iptables


















$ iptables -t filter -D INPUT -s 172.16.1.227 -j DROP
